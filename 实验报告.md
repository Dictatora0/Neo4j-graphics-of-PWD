# 基于文献的松材线虫病知识图谱构建实验报告

**课程名称**：知识工程  
**实验名称**：领域知识图谱自动构建  
**实验日期**：2025 年 11 月  
**小组**：第二组  
**项目主题**：基于文献的松材线虫病知识图谱构建  
**GitHub 仓库**：[https://github.com/Dictatora0/Neo4j-graphics-of-PWD.git](https://github.com/Dictatora0/Neo4j-graphics-of-PWD.git)

---

## 1. 实验目的

本实验是知识工程课程第二组的项目，旨在从松材线虫病（Pine Wilt Disease, PWD）相关的学术文献中自动提取知识实体和关系，构建结构化的知识图谱。通过本实验，我们学习并实践了以下知识工程核心技术：

1. **实体识别技术**：多策略融合的命名实体识别方法
2. **关系抽取技术**：基于规则和统计的关系抽取方法
3. **知识图谱构建**：从非结构化文本到结构化知识图谱的转换
4. **数据质量控制**：知识图谱数据的清洗、验证和优化
5. **图数据库应用**：Neo4j 图数据库的使用和查询

---

## 2. 实验环境

### 2.1 硬件环境

- 操作系统：macOS
- 处理器：Apple Silicon / Intel
- 内存：8GB+
- 存储：10GB+ 可用空间

### 2.2 软件环境

| 软件/工具    | 版本      | 用途         |
| ------------ | --------- | ------------ |
| Python       | 3.8+      | 主要开发语言 |
| Neo4j        | 4.x / 5.x | 图数据库     |
| PyMuPDF      | latest    | PDF 文本提取 |
| spaCy        | 3.7.x     | 自然语言处理 |
| pandas       | latest    | 数据处理     |
| scikit-learn | latest    | 机器学习算法 |

### 2.3 数据源

- **文献数量**：14 篇 PDF 学术论文
- **文献主题**：松材线虫病相关研究
- **文献类型**：中文和英文学术论文
- **总文本量**：约 50MB

---

## 3. 系统设计

### 3.1 系统架构

本系统采用模块化设计，包含以下核心模块：

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  PDF 文献   │ --> │  文本提取   │ --> │  实体识别   │ --> │  关系抽取   │ --> │  数据清洗   │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                         PyMuPDF           多策略 NER          模式匹配           去重/规范化
                                                               共现分析
                                                                    |
                                                                    v
                    ┌──────────────────────────────────────────────────────────┐
                    │                  Neo4j 知识图谱                           │
                    │              (可视化查询 / 知识推理)                       │
                    └──────────────────────────────────────────────────────────┘
```

### 3.2 核心模块设计

#### 3.2.1 PDF 文本提取模块

**功能**：从 PDF 文件中提取纯文本内容，过滤噪声信息

**技术要点**：

- 使用 PyMuPDF（fitz）库进行 PDF 解析
- 自动过滤页眉、页脚和参考文献
- 支持缓存机制，提升重复处理效率
- 支持并行处理，提升大规模文件处理速度

**详细处理流程**：

1. **PDF 文件读取**

   - 使用 `fitz.open()` 打开 PDF 文件
   - 逐页提取文本内容

2. **文本清洗**

   - 移除特殊控制字符（`\x00-\x1f`）
   - 统一行结束符（`\r\n`、`\r` → `\n`）

3. **页眉页脚过滤**

   - 识别页码模式（如"第 X 页"、"Page X"）
   - 过滤版权信息
   - 移除元数据行（作者、单位、收稿日期等）

4. **参考文献过滤**

   - 检测参考文献关键词（"参考文献"、"References"等）
   - 从检测到参考文献的位置开始，后续页面全部跳过

5. **句子分割**

   - 按中英文标点切分句子
   - 过滤过短句子（<10 字符）

6. **缓存机制**

   - 使用 MD5 哈希生成缓存键
   - 首次提取后保存到 `output/cache/` 目录
   - 重复处理时直接读取缓存

7. **并行处理**
   - 当 PDF 文件数量 ≥ 3 时自动启用并行处理
   - 默认使用 4 个工作进程
   - 可配置并行进程数

**关键代码逻辑**：

```python
# 提取文本并过滤
text = page.get_text()
text = self.clean_text(text)  # 移除特殊字符
text = self.remove_headers_footers(text)  # 过滤页眉页脚

# 检查参考文献
if self.is_reference_section(text):
    reference_started = True
    continue  # 跳过后续页面

# 句子分割
sentences = self.split_sentences(cleaned_text)
```

**处理结果**：

- 成功提取 14 个 PDF 文件的文本
- 总文本量约 50MB
- 平均每个 PDF 提取约 3-5MB 文本

#### 3.2.2 实体识别模块

**功能**：从文本中识别知识实体，并分类为 8 种实体类型

**采用的多策略方法**：

1. **TF-IDF 关键词提取**

   - 使用 `sklearn.feature_extraction.text.TfidfVectorizer`
   - 使用 jieba 对中文文本进行分词
   - 构建 TF-IDF 向量空间模型，提取每个文档的 top-50 关键词

2. **YAKE 关键词提取**

   - 使用 `yake.KeywordExtractor`
   - 设置语言为中文，提取 n-gram（n=3）关键词
   - 去重阈值 0.9，提取 top-30 关键词

3. **KeyBERT 关键词提取**

   - 使用 `KeyBERT` 模型
   - 基于 BERT 语义相似度计算，提取 n-gram（1-3）关键词
   - 提取 top-30 关键词

4. **spaCy NER**

   - 使用 `zh_core_web_sm` 和 `en_core_web_sm` 模型
   - 对文本进行分词和词性标注，识别命名实体
   - 限制处理长度为 1,000,000 字符（避免内存溢出）

5. **领域词典匹配**
   - 使用内置词典和外部词典文件（`config/domain_dict.json`）
   - 加载领域知识库（8 种实体类型，每种 10-20 个种子词）
   - 在文本中搜索匹配的词典词

**实体类型匹配算法**：

使用规则和词典相结合的方法：

1. **词典匹配**：优先使用领域知识库匹配
2. **规则匹配**：基于关键词规则判断
   - 包含"病"、"disease" → Disease
   - 包含"线虫"、"pathogen" → Pathogen
   - 包含"松"、"pine" → Host
   - 包含"天牛"、"beetle" → Vector
   - 包含"变色"、"枯死" → Symptom
   - 包含"防治"、"监测" → ControlMeasure
   - 包含"省"、"市"、"中国" → Region
   - 包含"温度"、"湿度" → EnvironmentalFactor

**候选词筛选**：

对提取的候选词进行严格筛选：

- 长度限制：2-30 字符
- 空格限制：≤ 2 个空格
- 标点限制：≤ 1 个标点符号
- 数字比例：≤ 30%
- 停用词过滤：排除常见停用词（"研究"、"分析"、"结果"等）

**处理流程**：

```
文本输入
  ↓
1. YAKE 提取关键词（30个）
  ↓
2. KeyBERT 提取关键词（30个）
  ↓
3. 合并关键词集合
  ↓
4. 领域词典匹配
  ↓
5. 对关键词进行类型匹配
  ↓
6. spaCy NER 识别命名实体
  ↓
7. 候选词筛选
  ↓
实体输出（name, type, source_pdf）
```

**处理结果**：

- 从 14 篇文献中提取 1,071 个原始实体
- 实体类型分布：Region (42.4%)、Host (21.8%)、Disease (11.8%) 等

**实体类型定义**：

| 实体类型            | 说明     | 示例                                 |
| ------------------- | -------- | ------------------------------------ |
| Disease             | 疾病     | 松材线虫病、PWD                      |
| Pathogen            | 病原体   | 松材线虫、Bursaphelenchus xylophilus |
| Host                | 宿主植物 | 马尾松、黑松                         |
| Vector              | 传播媒介 | 松褐天牛、Monochamus alternatus      |
| Symptom             | 症状     | 针叶变色、萎蔫                       |
| ControlMeasure      | 防控措施 | 清理病死树、化学防治                 |
| Region              | 地理区域 | 浙江、江苏                           |
| EnvironmentalFactor | 环境因素 | 温度、湿度                           |

#### 3.2.3 关系抽取模块

**功能**：识别实体之间的关系，生成关系三元组（head, relation, tail）

**采用的方法**：

1. **规则模式匹配**

   - 基于正则表达式的模式识别，为 9 种关系类型定义 3-5 个正则模式
   - 在文本中搜索匹配的模式，提取匹配的实体对
   - 清洗实体名称，验证关系方向
   - 关系模式示例：
     - `hasPathogen`: `(.+?)的病原[体为是](.+?)`、`(.+?)由(.+?)引起`
     - `hasHost`: `(.+?)侵染(.+?)`、`(.+?)寄主[为是](.+?)`
     - `hasVector`: `(.+?)由(.+?)传播`、`传播媒介[为是](.+?)`
     - `hasSymptom`: `症状[为是包括有](.+?)`、`表现为(.+?)`
     - `controlledBy`: `(.+?)防治[方法措施][为是包括有](.+?)`
     - `occursIn`: `(.+?)发生在(.+?)`、`在(.+?)[发生分布]`
     - `affectedBy`: `(.+?)受(.+?)影响`、`(.+?)与(.+?)[相关有关]`
   - 规则匹配的关系置信度：0.75-0.85
   - 如果使用默认实体（如"松材线虫病"），置信度降低至 0.72

2. **共现分析**

   - 统计实体在同一句子或窗口内的共现频率
   - 按句子分割文本，提取句子中出现的所有实体
   - 如果句子中包含 ≥ 2 个实体，生成实体对
   - 根据实体类型查找对应的关系类型，验证关系方向
   - 共现关系的置信度 = min(规则置信度 - 0.15, 0.7)

3. **关系方向校验**
   - 根据实体类型验证关系的合理性
   - 使用实体类型映射表验证关系方向
   - 验证规则：
     - `hasPathogen`、`hasHost`、`hasVector`、`hasSymptom`、`controlledBy`、`occursIn`：头实体必须是 Disease
     - `affectedBy`：头实体必须是 Disease
     - `transmits`：头实体必须是 Vector 或 Pathogen
     - `infects`：头实体必须是 Pathogen 或 Vector

**处理流程**：

```
文本 + 实体列表
  ↓
1. 构建实体映射（name → type）
  ↓
2. 规则模式匹配
   - 遍历所有关系模式
   - 提取匹配的实体对
   - 验证关系方向
  ↓
3. 共现分析
   - 按句子分割文本
   - 统计实体共现
   - 生成共现关系
  ↓
4. 合并关系列表
  ↓
关系输出（head, relation, tail, source_pdf, confidence）
```

**处理结果**：

- 从 14 篇文献中提取 1,502 条原始关系
- 关系类型分布：hasHost (42.1%)、hasVector (26.4%)、controlledBy (17.6%) 等

**关系类型定义**：

| 关系类型     | 说明       | 示例                    |
| ------------ | ---------- | ----------------------- |
| hasPathogen  | 有病原体   | 松材线虫病 → 松材线虫   |
| hasHost      | 有宿主     | 松材线虫病 → 马尾松     |
| hasVector    | 有传播媒介 | 松材线虫病 → 松褐天牛   |
| hasSymptom   | 有症状     | 松材线虫病 → 针叶变色   |
| controlledBy | 被控制     | 松材线虫病 → 清理病死树 |
| occursIn     | 发生在     | 松材线虫病 → 浙江       |
| affectedBy   | 受影响     | 松材线虫病 → 温度       |
| transmits    | 传播       | 松褐天牛 → 松材线虫     |
| infects      | 感染       | 松材线虫 → 马尾松       |

#### 3.2.4 数据清洗模块

**功能**：提升知识图谱数据质量，去除噪声和错误数据

**清洗策略**：

1. **实体清洗**

   - 移除空名称：删除 `name` 字段为空或仅包含空格的实体
   - 长度过滤：删除长度 < 2 字符或 > 30 字符的实体
   - 符号过滤：删除纯数字或纯符号的实体
   - 规范化实体名称：查找同义词映射表，合并同义词（如：`PWD`、`Pine Wilt Disease` → `松材线虫病`）
   - 相似实体合并：使用 `SequenceMatcher` 计算实体相似度，相似度阈值 0.85
   - 有效性验证：验证实体名称不包含中文标点，空格数量 ≤ 2，数字比例 ≤ 30%
   - 处理结果：原始实体 1,071 个，清洗后 1,021 个，删除 50 个（4.7%）

2. **关系清洗**

   - 规范化实体名称：对关系中的 `head` 和 `tail` 应用同义词映射
   - 置信度过滤：删除置信度 < 0.65 的关系
   - 移除自环关系：删除 `head == tail` 的关系
   - 实体有效性过滤：只保留 `head` 和 `tail` 都在有效实体集合中的关系
   - 关系方向验证：根据实体类型验证关系方向是否正确
   - 低频过滤：统计关系三元组出现频率，频率 ≥ 2 或频率 = 1 但置信度 ≥ 0.75 的保留
   - 去重：基于（head, relation, tail, source_pdf）去重
   - 处理结果：原始关系 1,502 条，清洗后 401 条，删除 1,101 条（73.3%）

3. **质量验证**
   - 验证实体类型一致性
   - 验证关系方向正确性
   - 检查孤立节点

#### 3.2.5 Neo4j 文件生成模块

**功能**：将清洗后的实体和关系转换为 Neo4j 可导入的格式

**处理流程**：

1. **生成节点 CSV 文件**

   - 提取实体字段：`id`、`name`、`type`
   - 重命名列：`type` → `label`（Neo4j 使用 label 作为节点类型）
   - 保存为 `nodes.csv`（格式：`id, name, label`）

2. **生成关系 CSV 文件**

   - 创建实体名称到 ID 的映射表
   - 将关系中的实体名称映射为 ID
   - 提取关系字段：`start_id`、`relation`、`end_id`、`confidence`
   - 保存为 `relations.csv`（格式：`start_id, relation, end_id, confidence`）

3. **生成 Cypher 导入脚本**

   - 生成标准版脚本（不依赖 APOC）
   - 生成 APOC 版脚本（使用 APOC 库，更简洁）
   - 包含数据清空、索引创建、节点导入、关系导入、验证查询等步骤

4. **生成 Python 导入脚本**
   - 自动连接 Neo4j 数据库
   - 执行 Cypher 脚本导入数据
   - 提供错误处理和进度显示

**输出文件**：

- `output/neo4j_import/nodes.csv` - 节点文件
- `output/neo4j_import/relations.csv` - 关系文件
- `output/neo4j_import/import.cypher` - Cypher 导入脚本
- `output/neo4j_import/import_with_apoc.cypher` - APOC 版脚本
- `output/neo4j_import/import_to_neo4j.py` - Python 自动导入脚本

---

## 4. 实验过程

### 4.1 数据准备

1. **收集文献**：将 14 篇松材线虫病相关的 PDF 学术论文放入 `文献/` 目录
2. **配置系统**：检查并配置 `config/config.yaml` 文件
3. **安装依赖**：运行 `bash install.sh` 安装所需 Python 包

### 4.2 知识提取流程

#### 步骤 1：PDF 文本提取

```bash
python main.py
```

**执行结果**：

- 成功提取 14 个 PDF 文件的文本内容
- 过滤页眉页脚和参考文献
- 生成文本文件存储在 `output/extracted_texts/` 目录

#### 步骤 2：实体识别

**处理过程**：

- 对每个文档的文本执行多策略实体识别
- TF-IDF 提取约 50 个关键词
- YAKE 提取约 30 个关键词
- KeyBERT 提取约 30 个关键词
- spaCy NER 识别命名实体
- 领域词典匹配补充专业术语

**中间结果**：

- 原始实体数量：1,071 个
- 实体类型分布：
  - Region: 454 (42.4%)
  - Host: 233 (21.8%)
  - Disease: 126 (11.8%)
  - Vector: 102 (9.5%)
  - ControlMeasure: 68 (6.3%)
  - Pathogen: 50 (4.7%)
  - EnvironmentalFactor: 27 (2.5%)
  - Symptom: 11 (1.0%)

#### 步骤 3：关系抽取

**处理过程**：

- 对每个文档执行规则模式匹配
- 计算实体共现频率
- 生成关系三元组（实体 1，关系类型，实体 2）
- 计算关系置信度

**中间结果**：

- 原始关系数量：1,502 条
- 关系类型分布：
  - hasHost: 632 (42.1%)
  - hasVector: 397 (26.4%)
  - controlledBy: 264 (17.6%)
  - hasPathogen: 204 (13.6%)
  - occursIn: 5 (0.3%)

#### 步骤 4：数据清洗

**处理过程**：

- 删除无效实体 50 个（介词开头、过长、过短等）
- 合并同义词和不完整实体
- 修正分类错误
- 删除无效关系 31 条
- 去除重复关系 1,070 条
- 删除自环关系

**清洗后结果**：

- 实体数量：1,021 个（减少 50 个，-4.7%）
- 关系数量：401 条（减少 1,101 条，-73.3%）

### 4.3 数据质量优化

为进一步提升数据质量，执行了以下优化步骤：

#### 步骤 5：数据修正

```bash
python fix_and_import.py
```

**修正内容**：

1. 删除包含特殊字符的实体
2. 删除学术术语和描述性短语
3. 删除不完整的词
4. 标准化实体名称

**修正后结果**：

- 实体数量：137 个（进一步精简）
- 关系数量：30 条（保留高质量关系）

#### 步骤 6：恢复核心实体

发现 Host 实体过少，执行恢复：

```bash
python restore_host_entities.py
```

**恢复内容**：

- 添加 11 个重要的宿主植物实体
- 为所有 Host 实体创建与松材线虫病的 `hasHost` 关系

**恢复后结果**：

- 实体数量：36 个
- 关系数量：43 条

#### 步骤 7：修正关系类型

发现关系类型使用错误，执行修正：

```bash
python fix_relation_types.py
```

**修正内容**：

- 将错误使用的 `hasPathogen` 关系改为 `affectedBy`
- 为松材线虫病添加缺失的 `hasSymptom` 关系
- 添加 `hasVector` 关系（松褐天牛）

**修正后结果**：

- 实体数量：37 个
- 关系数量：46 条

#### 步骤 10：症状和环境因素优化

```bash
python fix_symptoms_and_env_factors.py
```

**优化内容**：

1. 添加更多症状实体（从 1 个增加到 11 个）
2. 删除无意义的环境因素实体（"气象因子"）
3. 合并重复的环境因素（"高湿度" → "湿度"）
4. 为松材线虫病添加完整的症状关系

**优化后结果**：

- 实体数量：45 个
- 关系数量：37 条

#### 步骤 8：删除孤立节点

```bash
python remove_isolated_nodes.py
```

**处理结果**：

- 删除 112 个孤立节点（无任何关系）
- 最终保留 25 个有关系的核心实体

#### 步骤 9：最终优化

```bash
python fix_all_issues.py
```

**优化内容**：

- 添加缺失的松褐天牛实体
- 修正所有关系类型错误
- 添加缺失的关系

**最终结果**：

- 实体数量：44 个
- 关系数量：43 条
- 数据质量评分：优秀

### 4.4 Neo4j 导入

```bash
python import_fixed_data.py
```

**导入过程**：

1. 清空现有数据
2. 创建索引
3. 导入节点（44 个）
4. 导入关系（43 条）
5. 验证导入结果

**导入成功**：所有数据已成功导入 Neo4j 数据库

---

## 5. 实验结果与分析

### 5.1 最终数据统计

#### 5.1.1 节点统计

| 实体类型            | 数量 | 占比  | 说明                   |
| ------------------- | ---- | ----- | ---------------------- |
| Host                | 13   | 29.5% | 宿主植物               |
| Symptom             | 11   | 25.0% | 症状                   |
| ControlMeasure      | 11   | 25.0% | 防控措施               |
| EnvironmentalFactor | 3    | 6.8%  | 环境因素               |
| Region              | 2    | 4.5%  | 地理区域               |
| Vector              | 2    | 4.5%  | 传播媒介               |
| Disease             | 1    | 2.3%  | 疾病实体（松材线虫病） |
| Pathogen            | 1    | 2.3%  | 病原体                 |

**总计**：44 个节点

#### 5.1.2 关系统计

| 关系类型     | 数量 | 占比  | 说明            |
| ------------ | ---- | ----- | --------------- |
| hasHost      | 13   | 30.2% | 疾病 → 宿主     |
| hasSymptom   | 11   | 25.6% | 疾病 → 症状     |
| controlledBy | 11   | 25.6% | 疾病 → 防控措施 |
| affectedBy   | 3    | 7.0%  | 受环境影响      |
| hasVector    | 2    | 4.7%  | 疾病 → 传播媒介 |
| occursIn     | 2    | 4.7%  | 疾病 → 发生地区 |
| hasPathogen  | 1    | 2.3%  | 疾病 → 病原体   |

**总计**：43 条关系

### 5.2 知识图谱结构分析

#### 5.2.1 核心实体分析

**核心疾病实体**：松材线虫病

松材线虫病作为知识图谱的核心实体，具有完整的关联关系：

- **病原体关系**（hasPathogen）：1 条

  - 松材线虫病 → 松材线虫

- **宿主关系**（hasHost）：13 条

  - 松材线虫病 → 马尾松、黑松、赤松、油松、湿地松、华山松、云南松、思茅松、日本黑松、樟子松、白皮松、红松、火炬松

- **传播媒介关系**（hasVector）：2 条

  - 松材线虫病 → 天牛
  - 松材线虫病 → 松褐天牛

  - **症状关系**（hasSymptom）：11 条

    - 松材线虫病 → 枯死、针叶变色、萎蔫、树脂分泌停止、针叶褐变、针叶黄化、枝条枯萎、整株枯死、树干失水、材色变化、蓝变

- **环境影响关系**（affectedBy）：3 条

  - 松材线虫病 → 湿度、海拔、日照（已删除"气象因子"，合并"高湿度"到"湿度"）

- **防控措施关系**（controlledBy）：11 条

  - 松材线虫病 → 清理病死树、化学防治、生物防治、检疫、监测、焚烧、熏蒸、诱捕器、除害处理、营林措施、隔离带

- **发生地区关系**（occursIn）：2 条
  - 松材线虫病 → 中国、泰山

**关系完整性**：100%

#### 5.2.2 图谱拓扑结构

**中心性分析**：

松材线虫病作为核心实体，连接度最高：

- 直接连接：43 条关系（所有关系都连接到松材线虫病：hasHost: 13, hasSymptom: 11, controlledBy: 11, affectedBy: 3, occursIn: 2, hasVector: 2, hasPathogen: 1）
- 连接类型：7 种（hasPathogen, hasHost, hasVector, hasSymptom, affectedBy, controlledBy, occursIn）
- 网络中心性：最高

**传播链结构**：

```
松材线虫病
├─→ [hasPathogen] 松材线虫（病原体）
├─→ [hasVector] 天牛、松褐天牛（传播媒介）
├─→ [hasHost] 13种松树（宿主植物）
├─→ [hasSymptom] 11种症状（枯死、针叶变色、萎蔫等）
├─→ [affectedBy] 3种环境因素（湿度、海拔、日照）
├─→ [controlledBy] 11种防控措施（清理病死树、化学防治等）
└─→ [occursIn] 2个地区（中国、泰山）
```

该传播链完整地描述了松材线虫病的生物学特征和传播机制。

#### 5.2.3 实体分布特征

1. **Disease 实体**（14 个）

   - 核心实体：松材线虫病、pine wilt disease
   - 其他相关疾病：森林病、林木病、叶枯病等

2. **Host 实体**（13 个）

   - 全部为松科植物
   - 涵盖松材线虫病的主要宿主
   - 包括中文名和学名

3. **Pathogen 实体**（2 个）

   - 松材线虫（核心病原体）
   - 线虫病原（泛指）

4. **Vector 实体**（2 个）
   - 天牛（泛指）
   - 松褐天牛（主要传播媒介）

### 5.3 数据质量评估

#### 5.3.1 完整性检查

| 检查项         | 结果 | 状态    |
| -------------- | ---- | ------- |
| 孤立节点       | 0 个 | ✅ 优秀 |
| 自环关系       | 0 条 | ✅ 优秀 |
| 重复关系       | 0 组 | ✅ 优秀 |
| 空名称节点     | 0 个 | ✅ 优秀 |
| 关系类型正确性 | 100% | ✅ 优秀 |
| 核心实体完整性 | 100% | ✅ 优秀 |

#### 5.3.2 准确性验证

**核心实体验证**：

通过 Cypher 查询验证核心实体及其关系：

```cypher
MATCH (d:Disease {name: '松材线虫病'})-[r]-(n)
RETURN type(r) AS 关系类型, labels(n)[0] AS 目标类型, count(*) AS 数量
```

**验证结果**：

- ✅ 所有核心实体存在
- ✅ 所有关系类型正确
- ✅ 传播链完整

#### 5.3.3 一致性检查

**CSV 与 Neo4j 一致性**：

- CSV 节点数：44
- Neo4j 节点数：44
- ✅ 完全一致

- CSV 关系数：43
- Neo4j 关系数：43
- ✅ 完全一致

**数据质量评分**：优秀

### 5.4 知识图谱查询验证

#### 5.4.1 传播链查询

```cypher
MATCH (d:Disease {name: '松材线虫病'})-[:hasPathogen]->(p:Pathogen)
MATCH (d)-[:hasVector]->(v:Vector)
MATCH (d)-[:hasHost]->(h:Host)
MATCH (d)-[:hasSymptom]->(s:Symptom)
RETURN d.name AS 疾病,
       p.name AS 病原体,
       collect(v.name) AS 媒介,
       collect(h.name) AS 宿主,
       s.name AS 症状;
```

**查询结果**：

- 疾病：松材线虫病
- 病原体：松材线虫
- 传播媒介：天牛、松褐天牛
- 宿主植物：13 种松树
- 症状：枯死

**验证**：✅ 传播链完整，数据准确

#### 5.4.2 关系网络可视化

在 Neo4j Browser 中执行可视化查询：

```cypher
MATCH path = (d:Disease {name: '松材线虫病'})-[*1]-(n)
RETURN path
LIMIT 50;
```

**可视化结果**：

- 松材线虫病位于网络中心
- 连接 43 个相关实体（通过 43 条关系）
- 形成完整的知识网络

---

## 6. 实验总结

### 6.1 实验成果

1. **成功构建知识图谱**

   - 从 14 篇 PDF 文献中提取知识
   - 构建包含 44 个节点、43 条关系的知识图谱
   - 数据质量达到较高水平（无孤立节点、无自环、无错误关系类型、无重复关系）

2. **实现完整的技术流程**

   - PDF 文本提取
   - 多策略实体识别
   - 规则与统计结合的关系抽取
   - 数据清洗与质量优化
   - Neo4j 图数据库导入

3. **验证知识图谱完整性**
   - 核心实体完整
   - 传播链完整
   - 关系类型正确
   - 无孤立节点

### 6.2 技术要点总结

1. **多策略实体识别**

   - 结合 TF-IDF、YAKE、KeyBERT、spaCy NER 和领域词典
   - 提高了实体识别的准确率和召回率

2. **规则与统计结合的关系抽取**

   - 规则模式匹配保证准确率
   - 共现分析提高召回率
   - 置信度分级过滤低质量关系

3. **数据质量控制**
   - 多轮数据清洗
   - 关系类型验证
   - 孤立节点清理
   - 最终数据质量达到优秀水平

### 6.3 存在的问题与改进方向

#### 6.3.1 存在的问题

1. **实体数量较少**

   - 经过严格清洗后，实体数量从 1,071 减少到 44
   - 虽然质量提升，但可能丢失部分有用信息

2. **关系类型分布**

   - 当前主要关系类型为 `hasHost`（30.2%）和 `hasSymptom`（25.6%）
   - `controlledBy` 关系占 25.6%，分布相对均衡

3. **部分实体类型数量不足**
   - ✅ Symptom 已优化为 11 个（包含完整的症状列表）
   - ✅ ControlMeasure 已恢复为 11 个（包含完整的防控措施）
   - ✅ Region 已恢复为 2 个（中国、泰山）

#### 6.3.2 改进方向

1. **优化实体识别策略**

   - 调整清洗阈值，平衡质量和数量
   - 扩充领域词典
   - 改进实体链接算法

2. **丰富关系类型**

   - 添加更多关系模式
   - 优化关系抽取算法
   - 增加关系类型多样性

3. **扩展知识范围**
   - 添加更多症状实体
   - 补充防控措施实体
   - 增加环境因素实体

### 6.4 实验收获

通过本实验，我们小组深入学习了知识工程的核心技术：

1. **实体识别**：学习了多策略融合的实体识别方法
2. **关系抽取**：理解了规则与统计结合的关系抽取技术
3. **知识图谱构建**：掌握了从非结构化文本到结构化知识图谱的完整流程
4. **数据质量控制**：理解了知识图谱数据清洗和验证的重要性
5. **图数据库应用**：学习了 Neo4j 的使用和 Cypher 查询语言

### 6.5 应用价值

构建的知识图谱可用于：

1. **文献知识整合**：快速查找松材线虫病相关的所有信息
2. **传播链分析**：分析病害传播路径和关键节点
3. **防控策略研究**：查询和比较不同的防控措施
4. **疫情预测**：基于地区和环境因素预测疫情扩散
5. **知识问答**：构建基于知识图谱的问答系统

---

## 7. 参考文献

1. Neo4j 官方文档. https://neo4j.com/docs/
2. spaCy 官方文档. https://spacy.io/
3. KeyBERT: Minimal keyword extraction with BERT. https://github.com/MaartenGr/KeyBERT
4. YAKE: Yet Another Keyword Extractor. https://github.com/LIAAD/yake
5. 松材线虫病相关学术文献（14 篇）

---

## 附录

### 附录 A：核心代码文件

- `main.py` - 主程序入口
- `entity_recognizer.py` - 实体识别模块
- `relation_extractor.py` - 关系抽取模块
- `data_cleaner.py` - 数据清洗模块
- `neo4j_generator.py` - Neo4j 文件生成模块

### 附录 B：配置文件

- `config/config.yaml` - 系统配置文件
- `config/domain_dict.json` - 领域词典
- `config/stopwords.txt` - 停用词表

### 附录 C：输出文件

- `output/neo4j_import/nodes.csv` - Neo4j 节点文件（44 行）
- `output/neo4j_import/relations.csv` - Neo4j 关系文件（43 行）
- `output/neo4j_import/queries.cypher` - 查询示例文件

### 附录 D：数据质量验证脚本

- `comprehensive_data_check.py` - 全面数据质量检查
- `verify_current_data.py` - 数据验证工具
- `fix_all_issues.py` - 问题修复工具

---

**报告完成日期**：2025 年 11 月 7 日
