# 知识图谱改进建议

> **✅ 状态更新 (2025-11-14)**: 所有建议已实施完成！
>
> - ✅ 配置已优化 (方案 B)
> - ✅ 提示词已增强
> - ✅ 类别已标准化
> - ✅ 通用词过滤已添加
>
> **查看详情**: `IMPROVEMENTS_IMPLEMENTED.md`  
> **快速开始**: `QUICK_START.md`

---

## 当前问题分析

### 1. 概念提取质量不足

**问题**:

- 提取的概念太通用（compound, disease, factor, mechanism）
- 缺少具体的领域概念（松材线虫、松褐天牛、马尾松等）
- 122 个概念对于 14 篇文献来说偏少

**原因**:

- llama3.2:3b 模型能力有限
- 只处理了 50 个块（共 321 个块）
- Prompt 可能不够具体

**解决方案**:

1. **增加处理块数**: `max_chunks: 100` 或 `null`（全部）
2. **优化 Prompt**: 在 `concept_extractor.py` 中添加领域特定词汇
3. **使用更大模型**: 切换到 `mistral` 或 `zephyr`
4. **降低过滤阈值**: `min_importance: 1`（当前为 2）

### 2. 关系类型单一

**问题**:

- 97.7% 是共现关系
- 缺少语义关系

**原因**:

- LLM 提取的关系较少（只有 2.3%）
- 邻近性分析产生大量共现关系

**解决方案**:

1. **优化关系提取 Prompt**: 明确要求提取因果、传播、防治等关系
2. **增加关系类型权重**: 降低共现关系权重
3. **后处理过滤**: 删除低权重的共现关系

### 3. 类别混乱

**问题**:

- 中英文类别混杂
- 类别不统一

**解决方案**:

1. **统一类别映射**: 在 `concept_deduplicator.py` 中添加类别标准化
2. **使用中文类别**: 或全部使用英文

### 4. JSON 解析失败

**问题**:

- 部分块的 LLM 响应格式不正确

**解决方案**:

1. **增加重试机制**: 已有 3 次重试
2. **优化 Prompt**: 强调 JSON 格式
3. **添加格式验证**: 在解析前检查格式

## 推荐的配置调整

### 方案 A: 提高质量（推荐）

```yaml
llm:
  model: mistral # 使用更大模型
  max_chunks: 100 # 处理更多块
  timeout: 180

filtering:
  min_importance: 1 # 降低过滤阈值
  min_connections: 0
```

**预计时间**: 2-3 小时
**预期结果**: 300-500 个概念，更多语义关系

### 方案 B: 平衡速度和质量

```yaml
llm:
  model: llama3.2:3b
  max_chunks: 150 # 处理更多块
  timeout: 120

filtering:
  min_importance: 1
  min_connections: 0
```

**预计时间**: 1-1.5 小时
**预期结果**: 200-300 个概念

### 方案 C: 快速测试

```yaml
llm:
  model: llama3.2:3b
  max_chunks: 50 # 当前配置
  timeout: 120

filtering:
  min_importance: 1 # 只降低过滤阈值
  min_connections: 0
```

**预计时间**: 30 分钟
**预期结果**: 150-200 个概念

## 具体改进步骤

### 步骤 1: 优化概念提取 Prompt

编辑 `concept_extractor.py`，在 `extract_concepts` 方法中添加领域词汇：

```python
system_prompt = """你是一个专业的知识图谱构建助手。
从文本中提取松材线虫病相关的关键概念。

重点关注:
- 病原体: 松材线虫、线虫种类
- 寄主: 松树、马尾松、黑松
- 媒介: 松褐天牛、天牛种类
- 症状: 萎蔫、枯死、变色
- 防治: 药剂、方法、措施
- 环境因素: 温度、湿度、海拔
- 地理位置: 疫区、分布区

避免提取过于通用的词汇（如"因素"、"机制"、"过程"）。
"""
```

### 步骤 2: 优化关系提取 Prompt

```python
system_prompt = """提取实体之间的具体关系。

关系类型:
- 导致/引起: 病原导致症状
- 传播: 媒介传播病原
- 寄生于: 病原寄生于寄主
- 防治: 药剂防治病害
- 影响: 环境影响发病
- 分布于: 病害分布于地区
"""
```

### 步骤 3: 添加类别标准化

在 `concept_deduplicator.py` 中添加:

```python
CATEGORY_MAPPING = {
    'disease': '疾病',
    'organism': '生物',
    'factor': '因素',
    'mechanism': '机制',
    'location': '地点',
    'process': '过程',
    'treatment': '防治',
    # ... 更多映射
}
```

## 下一步行动

1. **立即可做**: 修改配置文件，降低过滤阈值，重新运行
2. **短期改进**: 优化 Prompt，提高概念质量
3. **长期优化**: 添加后处理规则，过滤通用概念
