# 知识图谱改进实施报告

**实施时间**: 2025-11-14
**方案选择**: 方案 B - 平衡速度和质量

---

## 已实施的改进

### 1. ✅ 配置优化 (`config/config.yaml`)

#### 变更内容:

```yaml
llm:
  max_chunks: 150 # 从 50 增加到 150

filtering:
  min_importance: 1 # 从 2 降低到 1
  min_connections: 0 # 从 1 降低到 0
```

#### 预期效果:

- **处理量**: 从 50 块增加到 150 块 (提升 200%)
- **概念数量**: 预计从 122 个增加到 200-300 个
- **处理时间**: 约 45-75 分钟 (vs 原来的 15-25 分钟)
- **保留率**: 更多低重要性概念被保留，减少过度过滤

---

### 2. ✅ 概念提取优化 (`concept_extractor.py`)

#### 变更内容:

**原提示词** (通用):

```
Extract key concepts. Categories: disease, organism, symptom...
```

**新提示词** (领域特定):

```
你是松材线虫病知识图谱构建专家。从文本中提取具体的领域概念。

重点关注:
- 病原体: 松材线虫、伴生细菌、线虫种类
- 寄主植物: 松树、马尾松、黑松、湿地松
- 媒介昆虫: 松褐天牛、云杉花墨天牛
- 病害症状: 萎蔫、枯死、变色、针叶脱落
- 防治措施: 药剂、诱捕器、生物防治
- 环境因子: 温度、湿度、海拔、气候
- 地理位置: 疫区、分布区、省份

避免: 过于通用的词(因素、过程、机制、方法)
```

#### 预期效果:

- ✅ 提取更多具体的领域概念 (松材线虫、松褐天牛等)
- ✅ 减少通用概念 (compound, disease, factor)
- ✅ 中文提示词提高中文文献的提取质量

---

### 3. ✅ 关系提取优化 (`concept_extractor.py`)

#### 变更内容:

**原提示词** (模糊):

```
Extract relationships between concepts.
```

**新提示词** (明确关系类型):

```
提取松材线虫病相关实体间的具体关系。

关系类型:
- 引起/导致: 病原引起症状、环境导致发病
- 传播: 媒介传播病原
- 寄生于: 病原寄生于寄主
- 感染: 病原感染寄主
- 防治: 药剂防治病害、措施控制媒介
- 影响: 环境影响发病、因素影响传播
- 分布于: 病害分布于地区
- 携带: 媒介携带病原
- 抑制: 药剂抑制病原

只提取明确的因果、功能关系，避免模糊的共现关系。
```

#### 预期效果:

- ✅ 提高语义关系比例 (从 2.3% 提升到 10-20%)
- ✅ 减少低质量共现关系
- ✅ 关系类型更加明确和有意义

---

### 4. ✅ 类别标准化 (`concept_deduplicator.py`)

#### 新增功能:

```python
CATEGORY_MAPPING = {
    # 英文到中文统一映射
    'disease': '疾病',
    'pathogen': '病原',
    'organism': '生物',
    'host': '寄主',
    'vector': '媒介',
    'symptom': '症状',
    'treatment': '防治',
    'environment': '环境',
    'location': '地点',
    # ... 更多映射
}
```

#### 预期效果:

- ✅ 解决中英文类别混杂问题
- ✅ 统一使用中文类别
- ✅ 提高图谱可读性和一致性

---

### 5. ✅ 通用概念过滤 (`concept_deduplicator.py`)

#### 新增功能:

```python
GENERIC_CONCEPTS = {
    'factor', 'mechanism', 'process', 'method', 'compound',
    'disease', 'organism', 'study', 'research', 'analysis',
    '因素', '机制', '过程', '方法', '化合物', '疾病',
    '生物', '研究', '分析', '结果', '影响', '作用',
}
```

#### 预期效果:

- ✅ 自动过滤过于通用的概念
- ✅ 提高概念质量和特异性
- ✅ 减少噪音节点

---

## 预期改进效果对比

| 指标             | 改进前         | 改进后 (预期)   | 提升     |
| ---------------- | -------------- | --------------- | -------- |
| **处理块数**     | 50/321 (15.6%) | 150/321 (46.7%) | +200%    |
| **概念数量**     | 122            | 200-300         | +64-146% |
| **具体概念比例** | 低             | 高              | 显著提升 |
| **语义关系比例** | 2.3%           | 10-20%          | +4-9 倍  |
| **类别一致性**   | 混乱           | 统一中文        | 完全解决 |
| **处理时间**     | 15-25 分钟     | 45-75 分钟      | +3 倍    |

---

## 使用方法

### 运行完整流程:

```bash
# 方式1: 使用完整工作流脚本
./run_complete_workflow.sh

# 方式2: 直接运行主程序
python main.py
```

### 查看结果:

```bash
# 查看统计信息
cat output/statistics_report.txt

# 查看提取的概念
head -20 output/triples/triples_*.csv

# 启动Neo4j查看图谱
./view_results.sh
```

---

## 进一步优化建议

### 短期 (1-2 天):

1. **监控首次运行**: 观察新配置的实际效果
2. **调整通用词列表**: 根据实际结果补充需要过滤的通用词
3. **优化重试机制**: 如果 JSON 解析失败率高，增加格式验证

### 中期 (1 周):

1. **尝试更大模型**: 如果效果不理想，切换到 `mistral` 或 `qwen`
2. **增加后处理规则**: 基于领域知识的规则过滤
3. **优化去重阈值**: 根据实际重复情况调整 `similarity_threshold`

### 长期 (1 个月):

1. **构建领域词典**: 收集松材线虫病专业术语
2. **训练专用模型**: 使用领域数据微调小模型
3. **人工标注验证**: 建立黄金标准数据集

---

## 问题排查

### 如果概念数量仍然偏少:

- 检查 `max_chunks` 是否生效
- 查看日志中的失败块数量
- 考虑降低 `min_importance` 到 0

### 如果仍有大量通用概念:

- 补充 `GENERIC_CONCEPTS` 列表
- 在提示词中强调"避免通用词"
- 提高 `min_importance` 阈值

### 如果处理时间过长:

- 减少 `max_chunks` (如 100)
- 使用更快的模型 (llama3.2:1b)
- 启用缓存避免重复处理

---

## 技术细节

### 改进的文件:

1. `config/config.yaml` - 配置参数调整
2. `concept_extractor.py` - 提示词优化
3. `concept_deduplicator.py` - 类别映射和通用词过滤

### 未修改的文件:

- `main.py` - 主流程逻辑
- `enhanced_pipeline.py` - 管道逻辑
- 其他模块保持不变

### 兼容性:

- ✅ 向后兼容现有配置
- ✅ 不影响已有缓存
- ✅ 可随时回滚到原配置

---

## 总结

本次改进采用**方案 B (平衡速度和质量)**，通过以下 5 个方面的优化:

1. ✅ **增加处理量** - 从 50 块增加到 150 块
2. ✅ **优化提示词** - 领域特定的中文提示词
3. ✅ **明确关系类型** - 9 种具体关系类型
4. ✅ **统一类别** - 中英文映射到统一中文类别
5. ✅ **过滤通用词** - 自动移除低质量概念

**预期效果**: 概念数量增加 64-146%，质量显著提升，关系更加丰富和准确。

**下一步**: 运行完整流程，观察实际效果，根据结果进行微调。
