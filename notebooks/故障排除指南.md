# ğŸ”§ Colab æ•…éšœæ’é™¤æŒ‡å—

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. âŒ NumPy/Pandas ç‰ˆæœ¬å†²çªé”™è¯¯

**é”™è¯¯ä¿¡æ¯**:

```
ValueError: numpy.dtype size changed, may indicate binary incompatibility
```

**åŸå› **: numpy å’Œ pandas ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œé€šå¸¸æ˜¯ Colab ç¯å¢ƒä¸­é¢„è£…çš„ç‰ˆæœ¬ä¸é¡¹ç›®éœ€è¦çš„ç‰ˆæœ¬å†²çªã€‚

**è§£å†³æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰**:

1. **é‡å¯è¿è¡Œæ—¶**

   - èœå•æ  â†’ è¿è¡Œæ—¶ â†’ é‡å¯è¿è¡Œæ—¶
   - æˆ–ä½¿ç”¨å¿«æ·é”®ï¼š`Ctrl+M .`

2. **é‡æ–°è¿è¡Œä¾èµ–å®‰è£…**

   - ä» `00_ç¯å¢ƒè®¾ç½®.ipynb` çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼å¼€å§‹
   - æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰å•å…ƒæ ¼

3. **ç­‰å¾…å®‰è£…å®Œæˆ**
   - æ•´ä¸ªå®‰è£…è¿‡ç¨‹çº¦éœ€ 2-3 åˆ†é’Ÿ
   - ç¡®ä¿çœ‹åˆ° "âœ… æ‰€æœ‰ä¾èµ–åŒ…å®‰è£…æˆåŠŸï¼"

**è§£å†³æ–¹æ¡ˆ Bï¼ˆæ‰‹åŠ¨ä¿®å¤ï¼‰**:

å¦‚æœæ–¹æ¡ˆ A æ— æ•ˆï¼Œæ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```python
# åœ¨ Colab å•å…ƒæ ¼ä¸­è¿è¡Œ
!pip uninstall -y numpy pandas scipy scikit-learn
!pip install --upgrade --force-reinstall --no-cache-dir numpy==1.26.2
!pip install --upgrade --force-reinstall --no-cache-dir pandas==2.1.4
!pip install --upgrade --force-reinstall --no-cache-dir scipy scikit-learn

# é‡å¯ Python è¿è¡Œæ—¶ï¼ˆè¿è¡Œæ­¤å‘½ä»¤åè¿è¡Œæ—¶ä¼šè‡ªåŠ¨é‡å¯ï¼‰
import os
os.kill(os.getpid(), 9)
```

---

### 2. âŒ OpenAI API é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:

```
AuthenticationError: Incorrect API key provided
```

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥ API Key**

   ```python
   # åœ¨æ–°å•å…ƒæ ¼ä¸­éªŒè¯
   import openai
   openai.api_key = "ä½ çš„API Key"

   # æµ‹è¯•è¿æ¥
   try:
       openai.Model.list()
       print("âœ… API Key æœ‰æ•ˆ")
   except Exception as e:
       print(f"âŒ API Key æ— æ•ˆ: {e}")
   ```

2. **è·å–æ–°çš„ API Key**

   - è®¿é—®: https://platform.openai.com/api-keys
   - åˆ›å»ºæ–°çš„ API Key
   - è¿”å› `00_ç¯å¢ƒè®¾ç½®.ipynb` æ›´æ–°é…ç½®

3. **æ£€æŸ¥è´¦æˆ·ä½™é¢**
   - è®¿é—®: https://platform.openai.com/account/billing
   - ç¡®è®¤æœ‰å¯ç”¨ä½™é¢

---

### 3. âŒ Neo4j è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:

```
ServiceUnavailable: Unable to connect to neo4j://...
```

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥ URI æ ¼å¼**

   ```python
   # æ­£ç¡®æ ¼å¼ï¼ˆNeo4j Auraï¼‰
   uri = "neo4j+s://xxxxx.databases.neo4j.io"

   # é”™è¯¯æ ¼å¼
   # uri = "https://xxxxx.databases.neo4j.io"  # âŒ
   # uri = "neo4j://xxxxx.databases.neo4j.io"   # âŒ ç¼ºå°‘ +s
   ```

2. **éªŒè¯è¿æ¥**

   ```python
   from neo4j import GraphDatabase

   driver = GraphDatabase.driver(
       "neo4j+s://ä½ çš„URI",
       auth=("neo4j", "ä½ çš„å¯†ç ")
   )

   try:
       driver.verify_connectivity()
       print("âœ… Neo4j è¿æ¥æˆåŠŸ")
   except Exception as e:
       print(f"âŒ è¿æ¥å¤±è´¥: {e}")
   finally:
       driver.close()
   ```

3. **æ£€æŸ¥ Neo4j å®ä¾‹çŠ¶æ€**
   - ç™»å½• Neo4j Aura Console
   - ç¡®è®¤å®ä¾‹æ­£åœ¨è¿è¡Œï¼ˆçŠ¶æ€ä¸º "Running"ï¼‰
   - å¦‚æœæ˜¯"Paused"ï¼Œç‚¹å‡»"Resume"æ¢å¤

---

### 4. âš ï¸ Colab ä¼šè¯è¶…æ—¶

**é—®é¢˜**: è¿è¡Œè¿‡ç¨‹ä¸­ Colab ä¼šè¯æ–­å¼€è¿æ¥

**è§£å†³æ–¹æ¡ˆ**:

1. **å¯ç”¨è‡ªåŠ¨é‡è¿**

   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼ˆF12 æ‰“å¼€æ§åˆ¶å°ï¼‰
   function ClickConnect() {
     console.log("Working");
     document.querySelector("colab-connect-button").click();
   }
   setInterval(ClickConnect, 60000);
   ```

2. **ä½¿ç”¨ Colab Pro**

   - å…è´¹ç‰ˆï¼šæœ€é•¿è¿è¡Œ 12 å°æ—¶
   - Pro ç‰ˆï¼šæœ€é•¿è¿è¡Œ 24 å°æ—¶
   - æ›´ç¨³å®šçš„ GPU/TPU è®¿é—®

3. **ä¿å­˜ä¸­é—´ç»“æœ**
   - æ‰€æœ‰æ­¥éª¤çš„è¾“å‡ºéƒ½å·²è‡ªåŠ¨ä¿å­˜åˆ° `output/` ç›®å½•
   - ä¼šè¯è¶…æ—¶åå¯ä»¥ä»ä¸Šæ¬¡å®Œæˆçš„æ­¥éª¤ç»§ç»­

---

### 5. ğŸ“¦ ä¾èµ–å®‰è£…ç¼“æ…¢

**é—®é¢˜**: pip å®‰è£…é€Ÿåº¦å¾ˆæ…¢æˆ–å¡ä½

**è§£å†³æ–¹æ¡ˆ**:

1. **ä½¿ç”¨å›½å†…é•œåƒï¼ˆå¯é€‰ï¼‰**

   ```python
   !pip install -i https://pypi.tuna.tsinghua.edu.cn/simple åŒ…å
   ```

2. **æ¸…é™¤ pip ç¼“å­˜**

   ```python
   !pip cache purge
   !pip install --no-cache-dir åŒ…å
   ```

3. **åˆ†æ‰¹å®‰è£…**
   - å°†ä¾èµ–åˆ†æˆå°æ‰¹æ¬¡å®‰è£…
   - é€ä¸ªéªŒè¯æ¯ä¸ªåŒ…

---

### 6. ğŸ’¾ å†…å­˜ä¸è¶³é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:

```
MemoryError: Unable to allocate array
```

**è§£å†³æ–¹æ¡ˆ**:

1. **å‡å°‘å¤„ç†æ‰¹æ¬¡**

   ```python
   # åœ¨ 00_ç¯å¢ƒè®¾ç½®.ipynb ä¸­ä¿®æ”¹
   CONFIG['llm']['max_chunks'] = 20  # ä» 30 å‡å°‘åˆ° 20
   ```

2. **æ¸…ç†å†…å­˜**

   ```python
   import gc
   gc.collect()

   # é‡Šæ”¾å¤§å˜é‡
   del large_dataframe
   gc.collect()
   ```

3. **ä½¿ç”¨ Colab Pro**
   - å…è´¹ç‰ˆï¼š~12GB RAM
   - Pro ç‰ˆï¼š~25GB RAM

---

### 7. ğŸ” Google Drive æŒ‚è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `ValueError: mount failed`

**å¸¸è§åŸå› **:

- æµè§ˆå™¨é˜»æ­¢äº†å¼¹å‡ºçª—å£
- æˆæƒè¶…æ—¶
- Colab ä¸ Google Drive è¿æ¥é—®é¢˜
- å·²ç»æŒ‚è½½ä½†æœªæ­£ç¡®å¸è½½

**è§£å†³æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰**ï¼š

1. **åˆ·æ–°é¡µé¢å¹¶é‡æ–°æŒ‚è½½**

   ```python
   # åˆ·æ–° Colab é¡µé¢ (Ctrl+R / Cmd+R)
   # ç„¶åé‡æ–°è¿è¡ŒæŒ‚è½½ä»£ç 
   from google.colab import drive
   drive.mount('/content/drive')
   ```

2. **æ£€æŸ¥æµè§ˆå™¨å¼¹å‡ºçª—å£**
   - ç‚¹å‡»åœ°å€æ å³ä¾§çš„å¼¹å‡ºçª—å£å›¾æ ‡
   - å…è®¸ Colab æ‰“å¼€å¼¹å‡ºçª—å£
   - é‡æ–°è¿è¡ŒæŒ‚è½½ä»£ç 

**è§£å†³æ–¹æ¡ˆ Bï¼ˆå¼ºåˆ¶é‡æ–°æŒ‚è½½ï¼‰**ï¼š

```python
from google.colab import drive

# å…ˆå¸è½½ï¼ˆå¦‚æœå·²æŒ‚è½½ï¼‰
try:
    drive.flush_and_unmount()
    print("å·²å¸è½½æ—§æŒ‚è½½ç‚¹")
except:
    pass

# å¼ºåˆ¶é‡æ–°æŒ‚è½½
drive.mount('/content/drive', force_remount=True)
print("âœ… Google Drive é‡æ–°æŒ‚è½½æˆåŠŸ")
```

**è§£å†³æ–¹æ¡ˆ Cï¼ˆæ‰‹åŠ¨æˆæƒï¼‰**ï¼š

1. è¿è¡ŒæŒ‚è½½ä»£ç 
2. ç‚¹å‡»ç”Ÿæˆçš„æˆæƒé“¾æ¥
3. åœ¨æ–°æ ‡ç­¾é¡µå®Œæˆ Google è´¦å·æˆæƒ
4. å¤åˆ¶æˆæƒç 
5. ç²˜è´´åˆ° Colab çš„è¾“å…¥æ¡†ä¸­

**è§£å†³æ–¹æ¡ˆ Dï¼ˆæ£€æŸ¥è¿è¡Œæ—¶çŠ¶æ€ï¼‰**ï¼š

```python
# æ£€æŸ¥æ˜¯å¦å·²æŒ‚è½½
import os
if os.path.exists('/content/drive'):
    print("âœ… Drive å·²æŒ‚è½½")
    !ls /content/drive
else:
    print("âŒ Drive æœªæŒ‚è½½")
```

**é¢„é˜²æªæ–½**ï¼š

```python
# ä½¿ç”¨æ›´å¥å£®çš„æŒ‚è½½ä»£ç 
from google.colab import drive
import os
import time

def mount_drive_robust(max_retries=3):
    """å¥å£®çš„ Drive æŒ‚è½½å‡½æ•°"""
    for attempt in range(max_retries):
        try:
            # æ£€æŸ¥æ˜¯å¦å·²æŒ‚è½½
            if os.path.exists('/content/drive/MyDrive'):
                print("âœ… Drive å·²æŒ‚è½½")
                return True

            # å°è¯•æŒ‚è½½
            print(f"å°è¯•æŒ‚è½½ Drive (ç¬¬ {attempt + 1} æ¬¡)...")
            drive.mount('/content/drive', force_remount=(attempt > 0))

            # éªŒè¯æŒ‚è½½æˆåŠŸ
            if os.path.exists('/content/drive/MyDrive'):
                print("âœ… Drive æŒ‚è½½æˆåŠŸ")
                return True

        except Exception as e:
            print(f"âš ï¸ æŒ‚è½½å¤±è´¥: {e}")
            if attempt < max_retries - 1:
                print("ç­‰å¾… 5 ç§’åé‡è¯•...")
                time.sleep(5)

    print("âŒ Drive æŒ‚è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥")
    return False

# ä½¿ç”¨
mount_drive_robust()
```

**å¦‚æœä»ç„¶å¤±è´¥**ï¼š

1. **æ£€æŸ¥ Google è´¦å·çŠ¶æ€**

   - è®¿é—® https://myaccount.google.com
   - ç¡®è®¤è´¦å·æ­£å¸¸ï¼Œæ— å®‰å…¨è­¦å‘Š

2. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**

   - æ¸…é™¤ Colab ç›¸å…³çš„ Cookie å’Œç¼“å­˜
   - é‡æ–°ç™»å½• Google è´¦å·

3. **ä½¿ç”¨æ— ç—•æ¨¡å¼**

   - åœ¨æµè§ˆå™¨æ— ç—•çª—å£æ‰“å¼€ Colab
   - é‡æ–°ç™»å½•å¹¶æŒ‚è½½

4. **åˆ‡æ¢ç½‘ç»œ**
   - æŸäº›ç½‘ç»œå¯èƒ½é˜»æ­¢ Google Drive è®¿é—®
   - å°è¯•åˆ‡æ¢åˆ°å…¶ä»–ç½‘ç»œæˆ–ä½¿ç”¨ VPN

**ä¸´æ—¶æ›¿ä»£æ–¹æ¡ˆ**ï¼š

å¦‚æœ Drive å§‹ç»ˆæ— æ³•æŒ‚è½½ï¼Œä½¿ç”¨ç›´æ¥ä¸Šä¼ ï¼š

```python
from google.colab import files

# ç›´æ¥ä¸Šä¼ æ–‡ä»¶
uploaded = files.upload()

# æˆ–ä½¿ç”¨ wget ä¸‹è½½
!wget https://your-file-url -O filename.pdf
```

---

### 8. ğŸ“ æ–‡ä»¶ç¼–ç é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š

```
UnicodeDecodeError: 'utf-8' codec can't decode
```

**è§£å†³æ–¹æ¡ˆ**:

1. **æŒ‡å®šç¼–ç **

   ```python
   # è¯»å– CSV æ—¶æŒ‡å®šç¼–ç 
   df = pd.read_csv('file.csv', encoding='utf-8-sig')

   # æˆ–å°è¯•å…¶ä»–ç¼–ç 
   df = pd.read_csv('file.csv', encoding='gbk')
   ```

2. **è½¬æ¢æ–‡ä»¶ç¼–ç **

   ```python
   # å°† GBK è½¬ä¸º UTF-8
   with open('input.txt', 'r', encoding='gbk') as f:
       content = f.read()

   with open('output.txt', 'w', encoding='utf-8') as f:
       f.write(content)
   ```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

```python
import traceback

try:
    # ä½ çš„ä»£ç 
    pass
except Exception as e:
    print("é”™è¯¯ç±»å‹:", type(e).__name__)
    print("é”™è¯¯ä¿¡æ¯:", str(e))
    print("\nå®Œæ•´å †æ ˆ:")
    traceback.print_exc()
```

### æ£€æŸ¥ç¯å¢ƒçŠ¶æ€

```python
# æ£€æŸ¥ Python ç‰ˆæœ¬
import sys
print(f"Python: {sys.version}")

# æ£€æŸ¥åŒ…ç‰ˆæœ¬
import pandas as pd
import numpy as np
print(f"NumPy: {np.__version__}")
print(f"Pandas: {pd.__version__}")

# æ£€æŸ¥å½“å‰ç›®å½•
import os
print(f"å½“å‰ç›®å½•: {os.getcwd()}")
print(f"ç›®å½•å†…å®¹: {os.listdir('.')}")
```

### æµ‹è¯•å„ä¸ªç»„ä»¶

```python
# æµ‹è¯• PDF æå–
import fitz
print("âœ… PyMuPDF OK")

# æµ‹è¯• OpenAI
import openai
print("âœ… OpenAI OK")

# æµ‹è¯• Neo4j
from neo4j import GraphDatabase
print("âœ… Neo4j driver OK")

# æµ‹è¯• Sentence Transformers
from sentence_transformers import SentenceTransformer
print("âœ… Sentence Transformers OK")
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**

   - æ¯ä¸ª notebook éƒ½æœ‰è¯¦ç»†çš„è¾“å‡º
   - æŸ¥çœ‹ `output/*_stats.json` æ–‡ä»¶

2. **æœç´¢é”™è¯¯ä¿¡æ¯**

   - å¤åˆ¶å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
   - åœ¨ Google æˆ– Stack Overflow æœç´¢

3. **æäº¤ Issue**

   - è®¿é—®é¡¹ç›® GitHub é¡µé¢
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ­¥éª¤

4. **Colab å®˜æ–¹æ–‡æ¡£**
   - https://colab.research.google.com/notebooks/intro.ipynb

---

## âœ… éªŒè¯æ¸…å•

åœ¨å¼€å§‹ä¸»æµç¨‹å‰ï¼Œç¡®è®¤ä»¥ä¸‹å„é¡¹ï¼š

```python
# è¿è¡Œæ­¤å•å…ƒæ ¼éªŒè¯æ‰€æœ‰ç»„ä»¶
def verify_setup():
    checks = {
        "NumPy": False,
        "Pandas": False,
        "OpenAI": False,
        "Neo4j": False,
        "Sentence Transformers": False,
        "é…ç½®æ–‡ä»¶": False
    }

    try:
        import numpy as np
        checks["NumPy"] = True
    except: pass

    try:
        import pandas as pd
        checks["Pandas"] = True
    except: pass

    try:
        import openai
        checks["OpenAI"] = True
    except: pass

    try:
        from neo4j import GraphDatabase
        checks["Neo4j"] = True
    except: pass

    try:
        from sentence_transformers import SentenceTransformer
        checks["Sentence Transformers"] = True
    except: pass

    try:
        import os
        checks["é…ç½®æ–‡ä»¶"] = os.path.exists("/content/PWD_Project/config/config_colab.yaml")
    except: pass

    print("ğŸ” ç¯å¢ƒæ£€æŸ¥:")
    for name, status in checks.items():
        symbol = "âœ…" if status else "âŒ"
        print(f"  {symbol} {name}")

    all_good = all(checks.values())
    if all_good:
        print("\nğŸ‰ æ‰€æœ‰ç»„ä»¶æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼")
    else:
        print("\nâš ï¸  éƒ¨åˆ†ç»„ä»¶æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹çš„æ•…éšœæ’é™¤æŒ‡å—")

    return all_good

verify_setup()
```

---

**æœ€åæ›´æ–°**: 2025-11-25
